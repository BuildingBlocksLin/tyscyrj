<!DOCTYPE html>
<html lang="zh">

	<head>
		<meta charset="UTF-8">
		<title>TYSCYRJ</title>

		<!-- Vue -->
		<script src="resource/vue.global.js"></script>
		<!-- Element+ -->
		<link rel="stylesheet" href="resource/element.css" />
		<script src="resource/element.full.js"></script>
	</head>

	<body>
		<div id="app">
			<el-row :gutter="15">
				<el-col :span="4">
					<el-input type="textarea" v-model="配方计算" autosize></el-input>
				</el-col>
				<el-col :span="4">
					<el-input type="textarea" v-model="计算值" autosize></el-input>
				</el-col>
				<el-col :span="16">
					<el-row>
						<el-checkbox-group v-model="选中的产物" @change="计算订单收益">
							<el-row v-for="工坊 in 所有产物" :key="工坊">
								<!-- <el-text>{{ 工坊[0] }}</el-text> -->
								<el-checkbox-button v-for="产物 in 工坊[1]" :key="产物" :label="产物">
									{{ 产物 }} - {{ 计算产物时间(产物).toFixed(2) }}
								</el-checkbox-button>
							</el-row>
						</el-checkbox-group>
					</el-row>
					<el-row>
						<el-input v-model="铜钱和经验" placeholder="输入铜钱和经验，用空格隔开" @change="计算订单收益" />
					</el-row>
					<el-row>
						<el-text>{{ 订单板 }}</el-text>
					</el-row>
				</el-col>
			</el-row>
		</div>

		<script>
			(async () => {
				const 配方 = {
					"农田": {
						"时间加成": -8 - 10,
						"小麦": {
							"时间": 2
						},
						"大豆": {
							"时间": 5
						},
						"甘蔗": {
							"时间": 10
						},
						"水稻": {
							"时间": 20
						},
						"白菜": {
							"时间": 30
						},
						"辣椒": {
							"时间": 60
						},
						"土豆": {
							"时间": 120
						},
						"苎麻": {
							"时间": 240
						},
						"南瓜": {
							"时间": 360
						}
					},
					"伐木林": {
						"时间加成": 0,
						"木材": {
							"时间": 5
						}
					},
					"竹林": {
						"时间加成": 0,
						"青竹": {
							"时间": 5
						}
					},
					"息壤": {
						"时间加成": 0,
						"原始土": {
							"时间": 5
						},
						"矿料": {
							"时间": 5
						}
					},
					"石磨": {
						"时间加成": -18 - 3,
						"面粉": {
							"小麦": 2,
							"时间": 5
						},
						"糕粉": {
							"水稻": 2,
							"时间": 20
						},
						"土豆粉": {
							"土豆": 3,
							"时间": 60
						}
					},
					"豆坊": {
						"时间加成": -18 - 3,
						"豆腐": {
							"大豆": 2,
							"时间": 10
						},
						"豆浆": {
							"大豆": 3,
							"时间": 20
						},
						"豆豉": {
							"大豆": 3,
							"辣椒": 3,
							"时间": 120
						}
					},
					"铡刀": {
						"时间加成": -9 - 3,
						"鸡饲料": {
							"小麦": 2,
							"大豆": 1,
							"时间": 10
						},
						"羊饲料": {
							"小麦": 2,
							"甘蔗": 1,
							"时间": 15
						}
					},
					"鸡舍": {
						"时间加成": -9 - 3,
						"鸡蛋": {
							"时间": 20
						},
						"鸡肉": {
							"时间": 20
						}
					},
					"制糖": {
						"时间加成": -18 - 3,
						"糖": {
							"甘蔗": 2,
							"时间": 15
						},
						"红糖": {
							"甘蔗": 3,
							"时间": 30
						},
						"麦糖": {
							"甘蔗": 3,
							"小麦": 3,
							"时间": 60
						}
					},
					"饼坊": {
						"时间加成": -18 - 3,
						"鸡蛋饼": {
							"面粉": 1,
							"鸡蛋": 2,
							"时间": 20
						},
						"烧饼": {
							"面粉": 2,
							"糖": 1,
							"时间": 40
						},
						"蔬菜饼": {
							"面粉": 2,
							"鸡蛋": 3,
							"白菜": 3,
							"时间": 60
						},
						"土豆饼": {
							"土豆粉": 1,
							"鸡蛋": 3,
							"红糖": 1,
							"时间": 120
						},
						"南瓜饼": {
							"面粉": 2,
							"南瓜": 3,
							"麦糖": 1,
							"鸡蛋": 3,
							"时间": 150
						}
					},
					"腌制": {
						"时间加成": -12 - 3,
						"咸鸡蛋": {
							"鸡蛋": 2,
							"时间": 30
						},
						"酸菜": {
							"白菜": 3,
							"时间": 40
						},
						"腌鸡肉": {
							"鸡肉": 1,
							"辣椒": 2,
							"时间": 60
						},
						"腌土豆": {
							"土豆": 3,
							"辣椒": 3,
							"时间": 90
						},
						"腌羊肉": {
							"羊肉": 1,
							"辣椒": 3,
							"时间": 180
						}
					},
					"豆腐加工": {
						"时间加成": -9 - 3,
						"油豆腐": {
							"豆腐": 1,
							"面粉": 1,
							"时间": 30
						},
						"腐竹": {
							"豆浆": 1,
							"糖": 1,
							"时间": 45
						},
						"豆腐乳": {
							"豆腐": 2,
							"辣椒": 2,
							"时间": 40
						},
						"豆筋": {
							"豆浆": 1,
							"红糖": 1,
							"时间": 60
						},
						"豆腐脑": {
							"豆腐": 2,
							"糖": 1,
							"时间": 120
						},
						"豆腐干": {
							"豆浆": 2,
							"时间": 90
						}
					},
					"木工": {
						"时间加成": -9 - 3,
						"陶艺木具": {
							"木材": 2,
							"时间": 30
						},
						"榫卯": {
							"木材": 4,
							"时间": 45
						},
						"鲁班锁": {
							"木材": 6,
							"时间": 120
						}
					},
					"糕坊": {
						"时间加成": -12 - 3,
						"糯米糕": {
							"糕粉": 1,
							"糖": 1,
							"时间": 45
						},
						"鸡蛋糕": {
							"鸡蛋": 3,
							"糕粉": 1,
							"红糖": 1,
							"时间": 60
						},
						"发糕": {
							"鸡蛋": 3,
							"糕粉": 1,
							"麦糖": 1,
							"时间": 120
						},
						"南瓜糕": {
							"南瓜": 3,
							"糕粉": 1,
							"红糖": 1,
							"时间": 180
						}
					},
					"编织": {
						"时间加成": -18 - 3,
						"竹片": {
							"青竹": 3,
							"时间": 30
						},
						"竹篓": {
							"青竹": 6,
							"时间": 90
						},
						"麻绳": {
							"苎麻": 3,
							"时间": 45
						},
						"斗笠": {
							"青竹": 3,
							"羊毛": 3,
							"时间": 120
						}
					},
					"玩具": {
						"时间加成": -9 - 3,
						"竹蜻蜓": {
							"竹片": 1,
							"榫卯": 1,
							"时间": 90
						},
						"泥哨": {
							"竹片": 1,
							"陶土": 1,
							"时间": 180
						},
						"竹板": {
							"竹片": 2,
							"时间": 150
						},
						"陀螺": {
							"麻绳": 1,
							"榫卯": 1,
							"时间": 120
						}
					},
					"土料": {
						"时间加成": -18 - 3,
						"陶土": {
							"原始土": 2,
							"时间": 30
						},
						"釉料": {
							"矿料": 2,
							"时间": 45
						},
						"釉彩": {
							"矿料": 4,
							"时间": 90
						}
					},
					"陶瓷": {
						"时间加成": -9 - 3,
						"陶器": {
							"陶土": 1,
							"陶艺木具": 1,
							"时间": 60
						},
						"单色瓷": {
							"陶土": 1,
							"釉料": 1,
							"陶艺木具": 1,
							"时间": 120
						},
						"彩绘瓷": {
							"陶土": 1,
							"釉料": 1,
							"釉彩": 1,
							"陶艺木具": 1,
							"时间": 240
						}
					},
					"文具": {
						"时间加成": -9 - 3,
						"砚": {
							"陶土": 2,
							"陶艺木具": 1,
							"时间": 150
						},
						"笔": {
							"竹片": 1,
							"羊毛": 3,
							"时间": 120
						},
						"纸": {
							"麻绳": 1,
							"羊毛": 3,
							"时间": 240
						}
					},
					"羊圈": {
						"时间加成": -3 - 3,
						"羊毛": {
							"时间": 60
						},
						"羊肉": {
							"时间": 60
						}
					},
					"晾晒": {
						"时间加成": -3 - 3,
						"南瓜籽": {
							"南瓜": 3,
							"时间": 120
						},
						"粉丝": {
							"土豆粉": 1,
							"时间": 180
						},
						"干豆豉": {
							"豆豉": 1,
							"时间": 240
						}
					},
					"纺织": {
						"时间加成": -3,
						"麻布": {
							"苎麻": 4,
							"时间": 60
						}
					}
				}
				const app = Vue.createApp({
					data() {
						return {
							配方: 配方,
							配方计算: undefined,
							计算值: undefined,
							// 所有产物: Object.keys(配方).map(工坊名 => Object.keys(配方[工坊名])).reduce((p, c) => p.concat(c))
							// 	.filter(产物名 => 产物名 != '时间加成'),
							所有产物: Object.keys(配方).map(工坊名 => [工坊名, Object.keys(配方[工坊名]).filter(产物名 => 产物名 !=
								'时间加成')]),
							选中的产物: [],
							铜钱和经验: '',
							订单板: ''
						}
					},
					methods: {
						计算() {
							this.配方计算 = '单个产物耗时\n'
							Object.keys(this.配方).forEach(工坊名 => {
								this.配方计算 += `${工坊名}（时间加成：${this.配方[工坊名]['时间加成']}）:\n`
								Object.keys(this.配方[工坊名]).forEach(产物名 => {
									if (产物名 != '时间加成' && 产物名 != '等级') {
										let 时间 = this.配方[工坊名][产物名]['时间']
										时间 = 时间 * (100 + (this.配方[工坊名]['时间加成'] || 0)) / 100
										this.配方计算 += `\t${产物名}: \t${this.时间转换(时间)}\n`
									}
								})
							})
							this.配方计算 = this.配方计算.substr(0, this.配方计算.length - 1)

							this.计算值 = '产物总耗时\n'
							Object.keys(this.配方).forEach(工坊名 => {
								this.计算值 += `${工坊名}（时间加成：${this.配方[工坊名]['时间加成']}）:\n`
								Object.keys(this.配方[工坊名]).forEach(产物名 => {
									if (产物名 != '时间加成' && 产物名 != '等级')
										this.计算值 +=
										`\t${产物名}: \t${this.时间转换(this.计算产物时间(产物名))}\n`
								})
							})
							this.计算值 = this.计算值.substr(0, this.计算值.length - 1)

							console.log(this.所有产物)
						},
						计算产物时间(产物名) {
							const 同时工坊 = ['农田', '鸡舍', '羊圈']
							const 工坊S = Object.values(this.配方)
							for (var i = 0; i < 工坊S.length; i++) {
								const 产物配方 = 工坊S[i][产物名]
								if (产物配方) {
									let 总时间 = 0
									Object.keys(产物配方).forEach(材料 => {
										if (材料 == '时间') {
											总时间 += 产物配方[材料] * (100 + (工坊S[i]['时间加成'] || 0)) / 100
										} else {
											if (同时工坊.some(工坊名 => this.配方[工坊名][材料])) {
												// 总时间 += this.计算产物时间(材料)
												总时间 += 0
											} else {
												总时间 += this.计算产物时间(材料) * 产物配方[材料]
											}
										}
									})
									return 总时间
								}
							}
						},
						计算订单收益() {
							let arr = this.铜钱和经验.split(' ')
							let time = this.选中的产物.reduce((p, c) => p + this.计算产物时间(c), 0)
							let 期望收益 = 1.7
							let 期望收益值 = time * 期望收益
							期望收益值 = 期望收益值.toFixed(2)
							if (arr.length == 2 && time) {
								let 铜钱收益 = arr[0] / time
								铜钱收益 = 铜钱收益.toFixed(2)
								let 经验收益 = arr[1] / time
								经验收益 = 经验收益.toFixed(2)
								let 综合收益 = Number(铜钱收益) + Number(经验收益)
								综合收益 = 综合收益.toFixed(2)
								this.订单板 =
									`耗时：${time.toFixed(0)}分钟，铜钱收益：${铜钱收益}，经验收益：${经验收益}，综合收益：${综合收益}，期望收益：${期望收益} - ${期望收益值}`
							} else {
								this.订单板 = `耗时：${time.toFixed(0)}分钟，期望收益：${期望收益} - ${期望收益值}`
							}
						},
						时间转换(分) {
							const 秒 = 分 * 60
							const 分显示 = Math.floor(秒 % 3600 / 60) < 10 ? `0${Math.floor(秒%3600/60)}` : Math
								.floor(秒 % 3600 / 60)
							const 秒显示 = Math.floor(秒 % 60) < 10 ? `0${Math.floor(秒%60)}` : Math.floor(秒 % 60)
							if (Math.floor(秒 / 3600)) {
								return `0${Math.floor(秒/3600)}时${分显示}分${秒显示}秒`
							} else {
								return `${分显示}分${秒显示}秒`
							}
						}
					},
				})
				app.use(ElementPlus)
				const vm = app.mount('#app')
				vm.计算()
			})()
		</script>
	</body>

	<script type="text/javascript" src="resource/dynamic.line.js"></script>
</html>